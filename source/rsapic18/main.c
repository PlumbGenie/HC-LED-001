/* RSA Library Optimized for PIC18 by Alfredo Ortega ortegaalfredo@gmail.com */

#include <xc.h>
#include <stdio.h>
#include "rsa.h"

  /* 512 bit keypair */
    const DIGIT_T     Mod[MAXDIGITS] = {0x83,0x12,0x9F,0x0F,0xD2,0xA9,0xD8,0x83,0xD9,0xB2,0x49,0xCD,0x69,0x76,0xF2,0x0E,0x81,0xF2,0x9B,0x51,0x3B,0x07,0x94,0x51,0x33,0xD1,0x1E,0x8C,0xDF,0x1F,0xDE,0xC9,0x94,0xAF,0xA0,0xF8,0xA2,0xE4,0xF7,0xF5,0xCB,0xD2,0xF8,0x0D,0x88,0xAD,0x9D,0x9C,0x64,0xE0,0xB5,0x54,0x85,0x63,0x49,0xE0,0x8A,0x19,0xE6,0xEB,0x2C,0xA4,0x93,0x57};
    const DIGIT_T PrivExp[MAXDIGITS] = {0x19,0xE2,0x0C,0x83,0x78,0x50,0x9B,0x31,0x61,0x29,0x63,0xD8,0x5D,0x3B,0xA5,0x33,0x40,0xC7,0x44,0xEB,0x9A,0x4F,0xB2,0x94,0xA3,0x8E,0x0A,0x52,0x98,0x2F,0xB4,0xFB,0xFF,0x1F,0x01,0xEC,0xDC,0xFB,0x8E,0x76,0xED,0xCC,0x05,0x02,0xCB,0xC3,0xC8,0xC6,0xA6,0x42,0xDD,0x0F,0x16,0x1A,0x1B,0x46,0xBC,0x10,0xD7,0xBF,0x38,0x19,0x2D,0x4F};
    const DIGIT_T  PubExp[MAXDIGITS] = {0x09,0x2F,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
 
 /* 128 bit keypair */
  // const DIGIT_T PrivExp[16] = {0x93,0xDF,0x28,0xA3,0x52,0x5E,0x56,0x41,0xA3,0x9A,0x48,0x05,0xC1,0xB7,0x21,0x33};
  // const DIGIT_T Mod[16] = {0x71,0x82,0x93,0xF9,0xF8,0xBA,0x2A,0x9F,0xF0,0xD0,0x49,0x6A,0xDC,0x8D,0xBB,0x99};
  // const DIGIT_T PubExp[16] = {0x8f,0x03,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

  /* 48 bit keypair */
  // const DIGIT_T PrivExp[16] = {0x87,0xc9,0x12,0,0,0,0,0,0,0,0,0,0,0,0,0};
  // const DIGIT_T Mod[16] =  {0x0b,0x78,0xbe,0xbd,0x59,0xe,0,0,0,0,0,0,0,0,0,0};
  // const DIGIT_T PubExp[16] = {0x8f,0x15,0x86,0x46,0x32,0x1,0,0,0,0,0,0,0,0,0,0};
 

unsigned char int2hex(unsigned char i)
{
if (i<=9) return (i+'0');
return(i+('A'-10));
}

void printChar(unsigned char c)
{
putch(int2hex(c >> 4));
putch(int2hex(c &  0x0F));
}

DIGIT_T m[MAXDIGITS],out[MAXDIGITS],x,y;
void main( void )
{
  int i;
  long lCont;
  copyright_notice();	
  mpSetZero(out,MAXDIGITS);
  mpSetZero(m,MAXDIGITS);
  m[0]=0x00;m[1]=0xd; // Message
  puts("\nMessage bytes: ");for (i=MAXDIGITS-1;i>=0;i--) printChar((unsigned char)m[i]);

  puts( "\nEncrypting...");
  mpModExp(out,m,PubExp,Mod,MAXDIGITS);
  puts("\nCrypt bytes: ");for (i=MAXDIGITS-1;i>=0;i--) printChar((unsigned char)out[i]);
  mpSetZero(m,MAXDIGITS);

  puts("\ndecrypting...");
  mpModExp(m,out,PrivExp,Mod,MAXDIGITS);
  puts("\nDecrypt bytes: "); for (i=MAXDIGITS-1;i>=0;i--) printChar((unsigned char)m[i]);
}
